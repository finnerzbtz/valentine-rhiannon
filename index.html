<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>For You</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a0a0a">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Fredoka:wght@600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0a0a0a;color:#d4af37;font-family:'Cormorant Garamond',serif;-webkit-tap-highlight-color:transparent;user-select:none;-webkit-user-select:none}

#pw-screen{position:fixed;inset:0;z-index:100;background:radial-gradient(ellipse at 50% 40%,rgba(150,20,50,.4),transparent 70%),radial-gradient(ellipse at 30% 70%,rgba(120,15,45,.25),transparent 55%),radial-gradient(ellipse at 75% 30%,rgba(180,30,60,.15),transparent 50%),#0a0a0a;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .8s,visibility .8s;overflow:hidden}
#pw-screen.gone{opacity:0;visibility:hidden;pointer-events:none}
#pw-screen .lock{font-size:80px;margin-bottom:16px;filter:drop-shadow(0 0 20px rgba(255,80,120,.3)) drop-shadow(0 0 40px rgba(255,50,100,.15));animation:lockPulse 3s ease-in-out infinite}
@keyframes lockPulse{0%,100%{transform:scale(1);filter:drop-shadow(0 0 20px rgba(255,80,120,.3))}50%{transform:scale(1.06);filter:drop-shadow(0 0 30px rgba(255,80,120,.5))}}
#pw-screen .pw-title{font-family:'Playfair Display',serif;font-style:italic;font-size:clamp(26px,7vw,36px);font-weight:400;color:#ff6b8a;margin-bottom:6px;letter-spacing:1px}
#pw-screen .pw-name{font-family:'Cormorant Garamond',serif;font-size:clamp(18px,5vw,24px);font-style:italic;color:rgba(255,170,185,.4);margin-bottom:40px;letter-spacing:2px}
#pw-screen label{font-family:'Cormorant Garamond',serif;font-size:13px;letter-spacing:2px;color:rgba(255,150,170,.4);margin-bottom:12px}
#pw-input{background:rgba(255,255,255,.06);border:1px solid rgba(255,100,140,.15);border-radius:24px;color:#ffb0c4;font-family:'Cormorant Garamond',serif;font-size:18px;padding:14px 24px;width:280px;text-align:center;outline:0;transition:border-color .3s,background .3s,box-shadow .3s}
#pw-input:focus{border-color:rgba(255,100,140,.35);background:rgba(255,255,255,.08);box-shadow:0 0 20px rgba(255,80,120,.1)}
#pw-input::placeholder{color:rgba(255,170,190,.2);font-style:italic}
#pw-err{color:#ff6b8a;font-size:14px;margin-top:14px;opacity:0;transition:opacity .3s;font-family:'Cormorant Garamond',serif;font-style:italic}
#pw-err.show{opacity:1}
#pw-screen .pw-hearts{position:absolute;inset:0;pointer-events:none;overflow:hidden}
#pw-screen .pw-heart{position:absolute;opacity:.2;animation:pwFloat linear infinite}
@keyframes pwFloat{0%{transform:translateY(100vh) rotate(0deg)}100%{transform:translateY(-100px) rotate(360deg)}}

canvas#ptcl{position:fixed;inset:0;z-index:0;pointer-events:none}

/* Simple static gradient background */
#bg-aura{position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse at 30% 40%,rgba(160,25,50,.2),transparent 60%),radial-gradient(ellipse at 70% 60%,rgba(255,50,110,.15),transparent 60%),radial-gradient(ellipse at 50% 80%,rgba(212,160,55,.1),transparent 50%),#0a0a0a}
50%{transform:translate(15vw,10vh) scale(1.15)}100%{transform:translate(5vw,20vh) scale(.95)}}
50%{transform:translate(-12vw,-8vh) scale(.9)}100%{transform:translate(-5vw,-15vh) scale(1.05)}}
50%{transform:translate(-10vw,12vh) scale(1.1)}100%{transform:translate(-18vw,5vh) scale(1)}}
50%{transform:translate(8vw,-10vh) scale(1.2)}100%{transform:translate(15vw,-5vh) scale(.9)}}
50%{transform:translate(-8vw,8vh) scale(.85)}100%{transform:translate(10vw,-8vh) scale(1.15)}}

#book{position:fixed;inset:0;z-index:1;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;transition:opacity 1s}
#book.vis{opacity:1}

.slide{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px 10px 50px;opacity:0;pointer-events:none;transition:opacity .3s ease}
.slide.active{opacity:1;transform:none;pointer-events:auto}

/* Transition: Soft glow fade */
.slide.active.t-glow{animation:glowIn .8s cubic-bezier(.23,1,.32,1) forwards}
@keyframes glowIn{0%{transform:scale(1.03)}100%{transform:scale(1)}}

/* Transition: Heartbeat zoom */
.slide.active.t-heart{animation:heartIn .7s cubic-bezier(.175,.885,.32,1.275) forwards}
@keyframes heartIn{0%{transform:scale(.5)}50%{transform:scale(1.06)}70%{transform:scale(.97)}100%{transform:scale(1)}}

/* Transition: Soft drift up */
.slide.active.t-rise{animation:riseIn .8s cubic-bezier(.23,1,.32,1) forwards}
@keyframes riseIn{0%{transform:translateY(40px) scale(.98)}100%{transform:translateY(0) scale(1)}}

/* Transition: Soft reveal (replaced clip-path which caused mobile flickering) */
.slide.active.t-reveal{animation:revealIn .8s ease-out forwards}
@keyframes revealIn{0%{opacity:.3;transform:scale(.9) rotate(-1deg)}100%{opacity:1;transform:scale(1) rotate(0)}}

/* Transition: Warm dissolve */
.slide.active.t-warm{animation:warmIn .8s ease forwards}
@keyframes warmIn{0%{transform:scale(1.03)}100%{transform:scale(1)}}

/* Hearts burst overlay */
#hearts-burst{position:fixed;inset:0;z-index:5;pointer-events:none;overflow:hidden}
.burst-heart{position:absolute;font-size:20px;opacity:0}
@keyframes floatHeart{0%{opacity:0;transform:translateY(0) scale(0) rotate(0)}15%{opacity:.8;transform:scale(1)}80%{opacity:.6}100%{opacity:0;transform:translateY(-60vh) scale(.5) rotate(25deg)}}

#cover h1{font-family:'Playfair Display',serif;font-size:28px;font-weight:400;color:#d4af37;text-align:center;line-height:1.5;margin-bottom:6px}
#cover .sub{font-size:20px;font-style:italic;color:rgba(212,175,55,.45);margin-bottom:50px}
#cover .hint{font-size:11px;letter-spacing:2px;text-transform:uppercase;color:rgba(212,175,55,.25);position:absolute;bottom:55px;animation:pulse 2.5s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:.2}50%{opacity:.6}}

.photo-frame{position:relative;max-width:92vw;max-height:68vh;border-radius:4px;overflow:hidden;box-shadow:0 0 30px rgba(212,175,55,.06),0 0 60px rgba(212,175,55,.03)}
.photo-frame img,.photo-frame video{display:block;max-width:92vw;max-height:68vh;object-fit:contain;border-radius:4px;transform:scale(1);transition:transform 3s ease-out}
.slide.active .photo-frame img,.slide.active .photo-frame video{transform:scale(1.06)}
.photo-frame::after{content:'';position:absolute;inset:0;border:1px solid rgba(212,175,55,.12);border-radius:4px;pointer-events:none}
.photo-glow{position:absolute;inset:-50px;background:radial-gradient(ellipse at center,rgba(212,175,55,.05) 0%,transparent 70%);pointer-events:none;z-index:-1}

#dots{position:fixed;bottom:55px;left:50%;transform:translateX(-50%);display:flex;gap:4px;z-index:10}
.dot{width:4px;height:4px;border-radius:50%;background:rgba(212,175,55,.15);transition:background .3s,transform .3s}
.dot.active{background:rgba(212,175,55,.7);transform:scale(1.4)}

#final h2{font-family:'Playfair Display',serif;font-size:22px;font-weight:400;color:#d4af37}
#final .msg{font-size:19px;font-style:italic;color:#d4af37;line-height:1.8;max-width:300px;opacity:.85;text-align:center;margin-top:20px}
#final .heart{font-size:40px;margin-bottom:24px;opacity:.5}
#final .sign{font-size:15px;color:rgba(212,175,55,.4);margin-top:28px}

#music-btn{position:fixed;top:14px;right:14px;z-index:50;width:34px;height:34px;border-radius:50%;background:rgba(212,175,55,.08);border:1px solid rgba(212,175,55,.15);color:#d4af37;font-size:15px;display:none;align-items:center;justify-content:center;cursor:pointer}
#music-btn.vis{display:flex}
#music-btn.playing{animation:spin 3s linear infinite}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

.page-num{position:absolute;bottom:28px;font-size:11px;letter-spacing:1px;color:rgba(212,175,55,.2)}
#love-text{position:fixed;bottom:280px;left:0;right:0;z-index:2;text-align:center;pointer-events:none;opacity:0;transition:opacity 1s}
#love-text.vis{opacity:1}
#love-text span{font-family:'Fredoka',sans-serif;font-size:clamp(44px,12vw,80px);font-weight:700;letter-spacing:3px;text-transform:uppercase;color:transparent;background:linear-gradient(135deg,#ff2060,#ff4080,#ff60a0,#ff2060);background-size:200% 200%;-webkit-background-clip:text;background-clip:text;animation:loveGlow 3s ease-in-out infinite,loveShift 6s ease-in-out infinite;filter:drop-shadow(0 0 12px rgba(255,50,100,.4)) drop-shadow(0 0 30px rgba(255,50,100,.15))}
@keyframes loveGlow{0%,100%{filter:drop-shadow(0 0 8px rgba(255,50,100,.3)) drop-shadow(0 0 25px rgba(255,50,100,.1))}50%{filter:drop-shadow(0 0 16px rgba(255,50,100,.6)) drop-shadow(0 0 40px rgba(255,50,100,.25))}}
@keyframes loveShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
#start-overlay{position:fixed;inset:0;z-index:90;background:rgba(10,10,10,.95);display:none;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;-webkit-tap-highlight-color:transparent}
#start-overlay.show{display:flex}
#start-overlay .play-icon{width:80px;height:80px;border:2px solid rgba(212,175,55,.4);border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:24px;transition:transform .2s,border-color .2s}
#start-overlay .play-icon::after{content:'';width:0;height:0;border-style:solid;border-width:16px 0 16px 28px;border-color:transparent transparent transparent rgba(212,175,55,.6);margin-left:6px}
#start-overlay:active .play-icon{transform:scale(.9);border-color:rgba(212,175,55,.8)}
#start-overlay .start-text{font-family:'Playfair Display',serif;font-size:14px;letter-spacing:3px;text-transform:uppercase;color:rgba(212,175,55,.5)}

#progress-bar{position:fixed;top:0;left:0;height:2px;background:linear-gradient(90deg,#d4af37,#f5d77a);z-index:60;width:0;transition:width .3s linear;pointer-events:none}
body.holding::after{content:'‚ùö‚ùö';position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:32px;color:rgba(212,175,55,.35);z-index:55;pointer-events:none;animation:holdFade .3s ease}
body.holding #book{filter:brightness(.85);transition:filter .2s ease}
@keyframes holdFade{from{opacity:0;transform:translate(-50%,-50%) scale(.8)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}
</style>
</head>
<body>

<div id="pw-screen">
  <div class="pw-hearts"><span class="pw-heart" style="left:8%;animation-duration:13s;animation-delay:-9s;font-size:31px">‚ù§Ô∏è</span><span class="pw-heart" style="left:20%;animation-duration:12s;animation-delay:-1s;font-size:24px">üíï</span><span class="pw-heart" style="left:32%;animation-duration:17s;animation-delay:-2s;font-size:34px">üíó</span><span class="pw-heart" style="left:40%;animation-duration:13s;animation-delay:-5s;font-size:30px">ü§ç</span><span class="pw-heart" style="left:53%;animation-duration:22s;animation-delay:-4s;font-size:25px">üíò</span><span class="pw-heart" style="left:66%;animation-duration:14s;animation-delay:-4s;font-size:30px">ü©∑</span><span class="pw-heart" style="left:76%;animation-duration:17s;animation-delay:-10s;font-size:24px">üíñ</span><span class="pw-heart" style="left:88%;animation-duration:22s;animation-delay:-7s;font-size:34px">‚ù§Ô∏è</span></div>
  <div class="lock">üíù</div>
  <div class="pw-title">Happy Valentine's Day</div>
  <div class="pw-name">Rhiannon</div>
  <label>type the magic words</label>
  <input type="text" id="pw-input" placeholder="..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <div id="pw-err">not quite... try again üíó</div>
</div>

<div id="love-text"><span>LOVE YOU <span id="pet-word">BABE</span></span></div>
<div id="bg-aura"></div>

<div id="hearts-burst"></div>
<div id="start-overlay">
  <div class="play-icon"></div>
  <div class="start-text">tap to begin</div>
</div>
<div id="book">
  <div class="slide active" id="cover">
    <h1>Happy<br>Valentine's Day</h1>
    <div class="sub">Rhiannon</div>
    <div class="hint">swipe to begin</div>
  </div>

  <div class="slide" data-idx="1">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/01_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="2">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/02_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="3">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/03_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="4">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/04_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="5">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/05_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="6">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <video data-src="photos/06.mp4" playsinline muted loop autoplay webkit-playsinline class="lazy-vid"></video>
    </div>
  </div>

  <div class="slide" data-idx="7">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/07_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="8">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/08_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="9">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/09_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="10">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/10_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="11">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/11_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="12">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/12_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="13">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/13_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="14">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/14_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="15">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/15_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="16">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/16_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="17">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/17_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="18">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/18_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="19">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/19_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="20">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/20_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="21">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/21_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="22">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/22_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="23">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/23_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="24">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/24_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="25">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/25_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="26">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/26_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="27">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/27_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="28">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <video data-src="photos/28.mp4" playsinline muted loop autoplay webkit-playsinline class="lazy-vid"></video>
    </div>
  </div>

  <div class="slide" data-idx="29">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <video data-src="photos/29.mp4" playsinline muted loop autoplay webkit-playsinline class="lazy-vid"></video>
    </div>
  </div>

  <div class="slide" data-idx="30">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <video data-src="photos/30.mp4" playsinline muted loop autoplay webkit-playsinline class="lazy-vid"></video>
    </div>
  </div>

  <div class="slide" data-idx="31">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/31_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="32">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/32_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="33">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/33_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="34">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/34_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="35">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/35_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="36">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/36_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="37">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/37_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="38">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/38_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="39">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/39_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="40">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/40_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="41">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/41_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="42">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/42_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="43">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/43_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="44">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/44_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="45">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/45_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="46">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/46_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="47">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/47_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="48">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <video data-src="photos/48.mp4" playsinline muted loop autoplay webkit-playsinline class="lazy-vid"></video>
    </div>
  </div>

  <div class="slide" data-idx="49">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <video data-src="photos/49.mp4" playsinline muted loop autoplay webkit-playsinline class="lazy-vid"></video>
    </div>
  </div>

  <div class="slide" data-idx="50">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <video data-src="photos/50.mp4" playsinline muted loop autoplay webkit-playsinline class="lazy-vid"></video>
    </div>
  </div>

  <div class="slide" data-idx="51">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/51_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="52">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/52_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="53">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/53_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="54">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/54_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="55">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/55_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="56">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/56_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="57">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/57_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="58">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/58_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="59">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/59_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="60">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/60_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="61">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/61_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="62">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/62_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="63">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/63_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="64">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/64_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="65">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <img data-src="photos/65_web.jpg" alt="" class="lazy">
    </div>
  </div>

  <div class="slide" data-idx="66">
    <div class="photo-glow"></div>
    <div class="photo-frame">
      <video data-src="photos/66.mp4" playsinline muted loop autoplay webkit-playsinline class="lazy-vid"></video>
    </div>
  </div>

  <div class="slide" id="final">
    <div class="heart">‚ù§Ô∏è</div>
    <div class="msg">you and me
always and forever</div>
    <div class="sign">forever yours x</div>
  </div>
</div>

<div id="progress-bar"></div>
<div id="dots"></div>
<div id="music-btn">‚ô´</div>
<audio id="bgm" preload="auto" src="music.mp3"></audio>

<script>
const PW='babeiloveyousomuchwhatdaheck';
const pwS=document.getElementById('pw-screen'),pwI=document.getElementById('pw-input'),pwE=document.getElementById('pw-err'),book=document.getElementById('book');
const mbtn=document.getElementById('music-btn'),bgm=document.getElementById('bgm');

pwI.addEventListener('input',()=>{pwE.classList.remove('show');if(pwI.value.toLowerCase().trim()===PW)unlock()});
pwI.addEventListener('keydown',e=>{if(e.key==='Enter'){if(pwI.value.toLowerCase().trim()===PW)unlock();else{pwE.classList.add('show');pwI.style.borderBottomColor='#ff6b6b';setTimeout(()=>pwI.style.borderBottomColor='',800)}}});

let unlocked=false;
function unlock(){
  if(unlocked)return;
  unlocked=true;
  pwS.classList.add('gone');// initPtcl();loadAround(0);
  setTimeout(()=>pwS.style.display='none',800);
  document.getElementById('start-overlay').classList.add('show');
}
document.getElementById('start-overlay').addEventListener('click',function(e){
  e.preventDefault();e.stopPropagation();
  try{
    this.classList.remove('show');
    this.style.display='none';
    book.classList.add('vis');document.getElementById('love-text').classList.add('vis');
    mbtn.classList.add('vis');
    loadAround(0);loadAround(3);loadAround(6);
    var playPromise=bgm.play();
    if(playPromise!==undefined){
      playPromise.then(()=>{
        playing=true;mbtn.classList.add('playing');mbtn.textContent='‚è∏';
        startAutoAdvance();requestAnimationFrame(updateProgress);
      }).catch(function(e){console.warn('Audio play failed:',e);startAutoAdvance();requestAnimationFrame(updateProgress)});
    } else {
      // Fallback for old browsers
      playing=true;startAutoAdvance();requestAnimationFrame(updateProgress);
    }
  }catch(err){console.error('Start error:',err)}
});

const slides=document.querySelectorAll('.slide');
const N=slides.length;
let cur=0;

// Dots
const dotsC=document.getElementById('dots');
for(let i=0;i<N;i++){const d=document.createElement('div');d.className='dot'+(i===0?' active':'');dotsC.appendChild(d)}
const dots=document.querySelectorAll('.dot');

const TRANSITIONS=['t-glow','t-heart','t-rise','t-reveal','t-warm'];
let tIdx=0;
function clearTransClasses(el){TRANSITIONS.forEach(t=>el.classList.remove(t));el.style.clipPath='';el.style.filter='';el.style.transform=''}
function burstHearts(){
  const c=document.getElementById('hearts-burst');
  // Cap burst hearts to prevent DOM bloat from rapid swiping
  if(c.childElementCount>30)return;
  const hearts=['‚ù§Ô∏è','üíï','üíó','üíñ','ü©∑','üß°'];
  const count=window.innerWidth<768?4:8;
  for(let i=0;i<count;i++){
    const h=document.createElement('span');
    h.className='burst-heart';
    h.textContent=hearts[Math.floor(Math.random()*hearts.length)];
    h.style.left=Math.random()*100+'%';
    h.style.bottom='-20px';
    h.style.fontSize=(14+Math.random()*18)+'px';
    h.style.animation='floatHeart '+(1.5+Math.random()*1.5)+'s ease-out '+(Math.random()*.3)+'s forwards';
    c.appendChild(h);
    setTimeout(()=>{if(h.parentNode)h.remove()},3500);
  }
}
const petWords=['BABE','BUB','BUNCH','CRUNCH','SCRUNCH','BUNNY','BUN','BOOBS','BABES','CRUNCHY','BUNCHY','SCRUNCHY','LOVELY','BUM','HONEYBUNCH','HONEYSCRUNCH','SCRUNCHBUNCH'];
let petIdx=0;
function cyclePetWord(){
  petIdx=(petIdx+1)%petWords.length;
  var el=document.getElementById('pet-word');
  if(el)el.textContent=petWords[petIdx];
}
function goTo(i){
  if(i<0||i>=N||i===cur)return;
  cyclePetWord();
  const prev=cur;
  cur=i;
  // Exit old slide
  clearTransClasses(slides[prev]);
  slides[prev].classList.remove('active');
  // Enter new slide with random transition
  clearTransClasses(slides[cur]);
  const t=null;
  tIdx++;
  slides[cur].classList.add('active');
  if(t)slides[cur].classList.add(t);
  dots[prev].classList.remove('active');
  dots[cur].classList.add('active');
  loadAround(cur);
  // Heart burst every 3 slides
  if(tIdx%5===0)burstHearts();
  // Video control
  const oldV=slides[prev].querySelector('video');
  if(oldV)oldV.pause();
  const newV=slides[cur].querySelector('video');
  if(newV){newV.currentTime=0;newV.muted=true;newV.play().catch(()=>{});}
}

// Lazy loading
function loadAround(idx){
  // Load current slide + 1 ahead for images, current only for video
  for(let d=-2;d<=4;d++){
    const j=idx+d;if(j<0||j>=N)continue;
    const s=slides[j];
    s.querySelectorAll('img.lazy').forEach(img=>{if(!img.src&&img.dataset.src)img.src=img.dataset.src;img.classList.remove('lazy')});
    // Only load video for current and next slide
    if(d>=-1&&d<=1){
      s.querySelectorAll('video.lazy-vid').forEach(vid=>{if(!vid.src&&vid.dataset.src){vid.src=vid.dataset.src;vid.load()}vid.classList.remove('lazy-vid')});
    }
  }
  // Unload videos that are far away (>2 slides) to free memory
  slides.forEach((s,i)=>{
    if(Math.abs(i-idx)>2){
      s.querySelectorAll('video').forEach(vid=>{
        if(vid.getAttribute('src')){
          vid.pause();
          vid.removeAttribute('src');
          // Remove all source children too
          while(vid.firstChild)vid.removeChild(vid.firstChild);
          vid.load();/* releases buffer */
          vid.classList.add('lazy-vid');
        }
      });
    }
  });
}
function loadAll(){
  // Only load images eagerly, NOT videos ‚Äî videos are loaded on-demand via loadAround()
  slides.forEach(s=>{
    s.querySelectorAll('img.lazy').forEach(img=>{if(!img.src&&img.dataset.src)img.src=img.dataset.src;img.classList.remove('lazy')});
    // Videos: do NOT bulk-load. loadAround() handles them when near the current slide.
  });
}

// === Auto-advance synced to music ===
const BAR_MS = 2308; // 104 BPM, 1 bar = 60/104*4 = 2.308s
const BAR_MS_VIDEO = BAR_MS * 2; // Videos get 2 bars
let autoTimer = null;
let holding = false;
let swiped = false;
const progressBar = document.getElementById('progress-bar');

function isVideoSlide(idx) {
  return !!slides[idx] && !!slides[idx].querySelector('video');
}

function startAutoAdvance() {
  stopAutoAdvance();
  if (!playing) return;
  const delay = isVideoSlide(cur) ? BAR_MS_VIDEO : BAR_MS;
  autoTimer = setTimeout(function tick() {
    if (!playing) return;
    if (!holding) {
      if (cur < N - 1) {
        goTo(cur + 1);
        const nextDelay = isVideoSlide(cur) ? BAR_MS_VIDEO : BAR_MS;
        autoTimer = setTimeout(tick, nextDelay);
      }
      // At last slide, stop (don't loop ‚Äî loop handled by audio event)
    } else {
      // Still holding, check again soon
      autoTimer = setTimeout(tick, 100);
    }
  }, delay);
}

function stopAutoAdvance() {
  if (autoTimer) { clearTimeout(autoTimer); autoTimer = null; }
}

// Update progress bar from audio
let progressRAF=null;
function updateProgress() {
  if (!playing){progressRAF=null;return}
  if (!document.hidden && bgm.duration && bgm.duration > 0) {
    const pct = (bgm.currentTime / bgm.duration) * 100;
    progressBar.style.width = pct + '%';
  }
  progressRAF=requestAnimationFrame(updateProgress);
}

// Music loop: restart slideshow from beginning
// Removed 'loop' attribute from <audio> so 'ended' fires reliably.
// We manually restart playback + slideshow here.
bgm.addEventListener('ended', () => {
  // Song finished - go to final message and stop
  goTo(N-1);
  stopAutoAdvance();
  playing=false;
  mbtn.classList.remove('playing');mbtn.textContent='‚ô´';
  progressBar.style.width='100%';
});

// Swipe + Hold-to-pause
let tx=0,ty=0,sw=false,lastSwipeTime=0;
document.addEventListener('touchstart',e=>{
  tx=e.touches[0].clientX;ty=e.touches[0].clientY;sw=true;
  // Hold-to-pause (only if book is visible)
  if (pwS.classList.contains('gone')) {
    holding = true;
    document.body.classList.add('holding');
  }
},{passive:true});

document.addEventListener('touchend',e=>{
  const dx=e.changedTouches[0].clientX-tx,dy=e.changedTouches[0].clientY-ty;
  swiped = Math.abs(dx)>Math.abs(dy)&&Math.abs(dx)>40;
  if(swiped&&sw){
    dx<0?goTo(cur+1):goTo(cur-1);
    lastSwipeTime = Date.now();
    // After manual swipe, restart auto-advance from new position
    if (playing) startAutoAdvance();
  }
  sw=false;
  // Release hold
  holding = false;
  document.body.classList.remove('holding');
},{passive:true});

document.addEventListener('touchcancel',()=>{
  holding = false;
  sw = false;
  document.body.classList.remove('holding');
},{passive:true});

// Tap edges (skip if just swiped to avoid double-advance)
document.addEventListener('click',e=>{
  if(pwS.style.display!=='none'&&!pwS.classList.contains('gone'))return;
  if(e.target.id==='music-btn'||e.target.closest('#music-btn'))return; // don't navigate on music btn
  if(Date.now() - lastSwipeTime < 400) return; // ignore click after swipe
  const x=e.clientX/window.innerWidth;
  if(x>.7){goTo(cur+1);if(playing)startAutoAdvance()}
  else if(x<.3){goTo(cur-1);if(playing)startAutoAdvance()}
});

// Keys
document.addEventListener('keydown',e=>{
  if(e.key==='ArrowRight'){goTo(cur+1);if(playing)startAutoAdvance()}
  if(e.key==='ArrowLeft'){goTo(cur-1);if(playing)startAutoAdvance()}
});

// Pause auto-advance when tab is hidden to prevent timer buildup
document.addEventListener('visibilitychange',()=>{
  if(document.hidden){stopAutoAdvance()}
  else if(playing){startAutoAdvance();requestAnimationFrame(updateProgress)}
});

// Valentine particle system ‚Äî gold sparkles, pink/rose dots, floating hearts
function initPtcl(){
  const c=document.getElementById('ptcl'),ctx=c.getContext('2d');let W,H,pts=[];
  function sz(){W=c.width=innerWidth;H=c.height=innerHeight}sz();
  addEventListener('resize',sz);
  const colors=[
    {r:212,g:175,b:55},  // gold
    {r:255,g:105,b:135}, // rose pink
    {r:255,g:60,b:100},  // hot pink
    {r:200,g:50,b:80},   // deep rose
    {r:255,g:150,b:170}, // soft pink
    {r:180,g:130,b:55},  // warm gold
  ];
  const numPtcl=window.innerWidth<768?16:28;
  for(let i=0;i<numPtcl;i++){
    const col=colors[Math.floor(Math.random()*colors.length)];
    const isHeart=Math.random()<0.18;
    pts.push({
      x:Math.random()*W,y:Math.random()*H,
      r:isHeart?(Math.random()*4+3):(Math.random()*2+.5),
      vx:(Math.random()-.5)*.2,
      vy:-(Math.random()*.12+.03),
      a:Math.random()*.25+.05,
      col:col,heart:isHeart,
      phase:Math.random()*Math.PI*2
    });
  }
  function drawHeart(x,y,size,alpha,col){
    ctx.save();ctx.translate(x,y);
    const s=size*0.6;
    ctx.beginPath();
    ctx.moveTo(0,s*0.35);
    ctx.bezierCurveTo(0,s*0.1,-s*0.5,-s*0.25,-s*0.5,s*0.05);
    ctx.bezierCurveTo(-s*0.5,s*0.45,0,s*0.6,0,s*0.85);
    ctx.bezierCurveTo(0,s*0.6,s*0.5,s*0.45,s*0.5,s*0.05);
    ctx.bezierCurveTo(s*0.5,-s*0.25,0,s*0.1,0,s*0.35);
    ctx.fillStyle=`rgba(${col.r},${col.g},${col.b},${alpha})`;
    ctx.fill();ctx.restore();
  }
  let lastDraw=0;
  function draw(now){
    if(document.hidden){requestAnimationFrame(draw);return}
    if(now-lastDraw<50){requestAnimationFrame(draw);return}
    lastDraw=now;
    ctx.clearRect(0,0,W,H);
    for(const p of pts){
      p.x+=p.vx;p.y+=p.vy;
      if(p.x<-10)p.x=W+10;if(p.x>W+10)p.x=-10;
      if(p.y<-10)p.y=H+10;if(p.y>H+10)p.y=-10;
      p.phase+=0.015;
      const alpha=Math.max(0.02,Math.min(0.35,p.a+Math.sin(p.phase)*0.08));
      if(p.heart){drawHeart(p.x,p.y,p.r,alpha,p.col)}
      else{ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=`rgba(${p.col.r},${p.col.g},${p.col.b},${alpha})`;ctx.fill()}
    }
    requestAnimationFrame(draw);
  }
  requestAnimationFrame(draw);
}

// Music

let playing=false;

function startMusic() {
  var p=bgm.play();
  if(p!==undefined){
    p.then(()=>{
      playing=true;
      mbtn.classList.add('playing');mbtn.textContent='‚è∏';
      startAutoAdvance();
      requestAnimationFrame(updateProgress);
    }).catch(function(e){console.warn('Music play failed:',e)});
  }
}

function pauseMusic() {
  bgm.pause();
  playing=false;
  mbtn.classList.remove('playing');mbtn.textContent='‚ô´';
  stopAutoAdvance();
}

function tryMusic(){
  mbtn.classList.add('vis');
}
mbtn.addEventListener('click',()=>{
  if(playing) pauseMusic();
  else startMusic();
});
</script>
</body>
</html>